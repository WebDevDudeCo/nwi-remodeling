---
import styles from './Testimonial.module.css';

export interface TestimonialProps {
  /** Quote text */
  quote: string;
  /** Name of the person giving the testimonial */
  name: string;
  /** Location or company of the person */
  location?: string;
  /** URL for the person's image (optional) */
  imageUrl?: string;
  /** Additional CSS class names */
  class?: string;
  /** Rating out of 5 */
  rating?: number;
}

const {
  quote,
  name,
  location,
  imageUrl,
  class: className = '',
  rating = 5
} = Astro.props;

// Generate array for star rating
const stars = Array.from({ length: 5 }, (_, i) => i < rating);
---

<div class={`${styles.testimonial} ${className}`}>
  <div class={styles.quote}>
    <svg class={styles.quoteIcon} xmlns="http://www.w3.org/2000/svg" width="42" height="36" viewBox="0 0 42 36" fill="none">
      <path d="M11.25 24H4.5C3.3 24 2.25 23.55 1.35 22.65C0.45 21.75 0 20.7 0 19.5V12C0 10.8 0.45 9.75 1.35 8.85C2.25 7.95 3.3 7.5 4.5 7.5H9C9.6 7.5 10.125 7.275 10.575 6.825C11.025 6.375 11.25 5.85 11.25 5.25V3.75C11.25 3.15 11.025 2.625 10.575 2.175C10.125 1.725 9.6 1.5 9 1.5H4.5V0H9C10.2 0 11.25 0.45 12.15 1.35C13.05 2.25 13.5 3.3 13.5 4.5V5.25C13.5 6.45 13.05 7.5 12.15 8.4C11.25 9.3 10.2 9.75 9 9.75H4.5C4.05 9.75 3.6875 9.9625 3.4125 10.2375C3.1375 10.5125 3 10.8 3 11.25V19.5C3 19.95 3.1375 20.3375 3.4125 20.6125C3.6875 20.8875 4.05 21.075 4.5 21.075H9.75C10.35 21.075 10.875 21.3 11.325 21.75C11.775 22.2 12 22.725 12 23.325V30.75C12 31.35 11.775 31.875 11.325 32.325C10.875 32.775 10.35 33 9.75 33H4.5V30.075H9.75V23.325C9.75 23.175 9.675 23.025 9.525 22.875C9.375 22.725 9.225 22.65 9.075 22.65H4.5C3.3 22.65 2.25 22.2 1.35 21.3C0.45 20.4 0 19.35 0 18.15V11.25C0 10.05 0.45 9 1.35 8.1C2.25 7.2 3.3 6.75 4.5 6.75H9C9.45 6.75 9.8125 6.5625 10.0875 6.2875C10.3625 6.0125 10.5 5.7 10.5 5.25V4.5C10.5 4.05 10.3625 3.6875 10.0875 3.4125C9.8125 3.1375 9.45 3 9 3H3V0.75H9C9.9 0.75 10.6875 1.0875 11.3625 1.7625C12.0375 2.4375 12.375 3.225 12.375 4.125V5.25C12.375 6.15 12.0375 6.9375 11.3625 7.6125C10.6875 8.2875 9.9 8.625 9 8.625H4.5C3.9 8.625 3.375 8.85 2.925 9.3C2.475 9.75 2.25 10.275 2.25 10.875V19.125C2.25 19.725 2.475 20.25 2.925 20.7C3.375 21.15 3.9 21.375 4.5 21.375H11.25V24ZM30.75 24H24C22.8 24 21.75 23.55 20.85 22.65C19.95 21.75 19.5 20.7 19.5 19.5V12C19.5 10.8 19.95 9.75 20.85 8.85C21.75 7.95 22.8 7.5 24 7.5H28.5C29.1 7.5 29.625 7.275 30.075 6.825C30.525 6.375 30.75 5.85 30.75 5.25V3.75C30.75 3.15 30.525 2.625 30.075 2.175C29.625 1.725 29.1 1.5 28.5 1.5H24V0H28.5C29.7 0 30.75 0.45 31.65 1.35C32.55 2.25 33 3.3 33 4.5V5.25C33 6.45 32.55 7.5 31.65 8.4C30.75 9.3 29.7 9.75 28.5 9.75H24C23.55 9.75 23.1875 9.9625 22.9125 10.2375C22.6375 10.5125 22.5 10.8 22.5 11.25V19.5C22.5 19.95 22.6375 20.3375 22.9125 20.6125C23.1875 20.8875 23.55 21.075 24 21.075H29.25C29.85 21.075 30.375 21.3 30.825 21.75C31.275 22.2 31.5 22.725 31.5 23.325V30.75C31.5 31.35 31.275 31.875 30.825 32.325C30.375 32.775 29.85 33 29.25 33H24V30.075H29.25V23.325C29.25 23.175 29.175 23.025 29.025 22.875C28.875 22.725 28.725 22.65 28.575 22.65H24C22.8 22.65 21.75 22.2 20.85 21.3C19.95 20.4 19.5 19.35 19.5 18.15V11.25C19.5 10.05 19.95 9 20.85 8.1C21.75 7.2 22.8 6.75 24 6.75H28.5C28.95 6.75 29.3125 6.5625 29.5875 6.2875C29.8625 6.0125 30 5.7 30 5.25V4.5C30 4.05 29.8625 3.6875 29.5875 3.4125C29.3125 3.1375 28.95 3 28.5 3H22.5V0.75H28.5C29.4 0.75 30.1875 1.0875 30.8625 1.7625C31.5375 2.4375 31.875 3.225 31.875 4.125V5.25C31.875 6.15 31.5375 6.9375 30.8625 7.6125C30.1875 8.2875 29.4 8.625 28.5 8.625H24C23.4 8.625 22.875 8.85 22.425 9.3C21.975 9.75 21.75 10.275 21.75 10.875V19.125C21.75 19.725 21.975 20.25 22.425 20.7C22.875 21.15 23.4 21.375 24 21.375H30.75V24Z" fill="currentColor" />
    </svg>
    <p>{quote}</p>
  </div>

  <div class={styles.rating}>
    {stars.map(filled => (
      <span>
        {filled ? 
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class={styles.starFilled}>
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
        : 
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" class={styles.starEmpty}>
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
        }
      </span>
    ))}
  </div>
  
  <div class={styles.author}>
    {imageUrl && (
      <div class={styles.imageWrapper}>
        <img 
          src={imageUrl} 
          alt={`Photo of ${name}`} 
          class={styles.image}
          width="60" 
          height="60" 
          loading="lazy"
        />
      </div>
    )}
    <div class={styles.info}>
      <h4 class={styles.name}>{name}</h4>
      {location && <p class={styles.location}>{location}</p>}
    </div>
  </div>
</div>